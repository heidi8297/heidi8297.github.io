<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <title>Natural Disasters</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
  <script type="text/javascript">
    var analytics = true;
    try {
      if(
        'localStorage' in window &&
        window['localStorage'] !== null &&
        localStorage["analytics"] == 'no' // check for local 'analytics' variable
      ) { analytics = false }             // if value is set to no, DO NOT TRACK
    } catch (e) {}                 // this logic courtesy of Mathieu Decaffmeyer
    if (analytics) {
      window.dataLayer = window.dataLayer || [];
      function gtag() {dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-12NPY4109R');
    } else { console.log('Google Analytics disabled') }
  </script>


  <!-- Make the webpage perform better on mobile? -->
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=0.24,maximum-scale=5.0,user-scalable=yes">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="description" content="A look at the increasing natural disasters across the globe between 1960 and 2018">
  <meta name="news_keywords" content="disasters, scrollytelling, scroll-driven, graphics, d3, scrollmagic, waypoints, graph-scoll, scrollstory, in-view">

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Natural Disasters" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://heidistockton.com/naturaldisasters/naturalDisastersThumbnail.png" />
  <meta property="og:description" content="A look at the increasing natural disasters across the globe between 1960 and 2018" />
  <meta property="og:url" content="http://heidistockton.com/naturaldisasters/" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Cabin+Sketch&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>

  <!-- primary style sheet -->
  <link rel="stylesheet" href="/core.css" type="text/css">
  <link rel='stylesheet' href='disaster-styles.css' />


</head>


<body>

  <header>
    <h1>Natural Disasters</h1>
    <h2>1960-2018</h2>
    <p>This is my paragraph text to test font styles and other formatting.</p>
  </header>


  <main>
    <div class='library__graphic graphic flex-container'>
      <!-- scrolly text section -->
      <div class='graphic__prose'>
        <p class='preProse active'>If the visualization doesn't fit your screen, try zooming out with ctrl + - / Cmd + -.</p>
        <p class='trigger pane1 active' data-step='0'>pane ONE: This is a grid of all disasters in the data set.  I'll add some basic stats about the data to the graphic as well.</p>
        <p class='trigger pane2' data-step='1'>pane TWO: This will be a horizontal bar chart showing total disaster counts by type.</p>
        <div class="legendSticky">  <!-- this div is to assist with positioning/containing the legends -->
          <div class="absoluteWrapper">
            <div id="legendIconWrapper">
              <img src="legendIcon.svg" class="legendIconImage" alt="Legend icon - click to reveal applicable legends">
              <img src="legendHideIcon.svg" class="legendHideIconImage" alt="Arrow icon - click to hide legends">
            </div>
            <div id="legendWrapper">
              <div class="colorLegend1"></div>
              <div class="sizeLegend1"></div>
              <div class="sizeLegend2"></div>
              <img src="teardropTextToPath.svg" class="teardropLegend" style="display: none;" alt="Teardrop legend for deadliest 15 events">
            </div>
          </div>
          <div class="legendInstructions">
            <p><--- click here to hide legend</p>
          </div>
          <!-- the height of this div is updated based on whether or not the legends are being shown -->
          <!-- doing so improves the waypoints trigger interactions and available reading space for the scrolly text -->
          <div class="variableSpacer"></div>
          <div class='trigger pane3' data-step='2'>
            <p>
              pane THREE: This will be an animation showing a map of events by year.  I may also have an area chart at the bottom showing event counts by year and type.
            </p>
          </div>
          <div class="trigger pane4" data-step='3'>
            <p>pane THREE B: I may add another step here where I then summarize the total increase in events between the first ten years and the last ten years of the data set.</p>
          </div>
          <p class='trigger pane4' data-step='4'>pane FOUR: This will be a vertical bar chart showing the deadliest overall event types.</p>
          <p class='trigger pane5' data-step='5'>pane FIVE: This will be a set of slopegraphs showing event frequency increases and death rate changes by type.</p>
          <p class='trigger pane6' data-step='6'>pane SIX: This will be a log plot showing deaths for each event, along with their 'typical' (median) values for each type.</p>
          <p class='trigger pane7' data-step='7'>pane SEVEN: This is a plot of deaths for each event (linear scale this time) to highlight that a small subset of events are responsible for the majority of the deaths.</p>
          <p class='trigger pane8' data-step='8'>pane EIGHT: This will be a map of the top 15 deadliest events.</p>
          <p class='trigger pane9' data-step='9'>pane NINE: This will plot the top 15 deadliest events by GDP.</p>
        </div>
        <p class='trigger pane9B' data-step='10'>pane NINE B: This will plot all events by GDP (shown below the above graph, will need a duplicate set of elements).</p>
        <p class='trigger pane10' data-step='11'>pane TEN: This is the final landing step - some artsy randomness as a backdrop for some final words.</p>
        <div class='postProse thanks'>
          Built on the shoulders of giants.
          <ul>
            <li>
              Data from <a target="_blank" href="https://sedac.ciesin.columbia.edu/data/set/pend-gdis-1960-2018">SEDAC (NASA)</a>,
              <a target="_blank" href="https://www.emdat.be/">EM-DAT</a>, and
              <a target="_blank" href="https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)_per_capita">Wikipedia</a>
            </li>
            <li>
              Inspiration from <a target="_blank" href="http://www.r2d3.us/visual-intro-to-machine-learning-part-1/">Tony Yu</a> and
              <a target="_blank" href="https://public.tableau.com/app/profile/george.gorczynski/viz/naturaldisasters_country/NaturalDisasters">George Gorczynski</a>
            </li>
            <li>Super helpful blog posts, modules and code snippets from <a target="_blank" href="https://d3-legend.susielu.com/">Susie Lu</a>,
              <a target="_blank" href="https://bost.ocks.org/mike/">Mike Bostock</a>,
              <a target="_blank" href="http://bl.ocks.org/smoli/d7e4f9199c15d71258b5">Stephan Smola</a>,
              <a target="_blank" href="https://www.visualcinnamon.com/2015/11/learnings-from-a-d3-js-addict-on-starting-with-canvas/">Nadieh Bremer</a>,
              <a target="_blank" href="https://www.freecodecamp.org/news/d3-and-canvas-in-3-steps-8505c8b27444/">Lars Verspohl</a>,
              and <a target="_blank" href="https://pudding.cool/process/how-to-implement-scrollytelling/">Russell Goldenberg</a>
            </li>
          </ul>
          Thank you!
        </div>
      </div>

      <!-- this is where the drawing spaces will sit (canvas and svg) -->
      <div id="viz-container"></div>
    </div>







    <div id="contactMe">
      <!-- placeholder for my standard "contact me" footer content -->
      <div w3-include-html="/footer.html"></div>
    </div>

  </main>




  <!-- for the graphic - d3-legend and annotation libraries courtesy of Susie Lu -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js" charset="utf-8"></script>
  <script src='disaster-main.js'></script>

  <!-- load core.js file -->
  <script src="/core.js"></script>

  <!-- The scroll library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/noframework.waypoints.js"></script>

  <!-- FPS stats utility (for testing) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r14/Stats.js"></script>

  <!-- setting up the waypoints/triggers -->
  <script>
    (function() {

      // helper function so we can map over dom selection
      function selectionToArray(selection) {
        var len = selection.length
        var result = []
        for (var i = 0; i < len; i++) {
          result.push(selection[i])
        }
        return result
      } // selectionToArray()

      function waypoints() {
        // select dom elements
        var graphicEl = document.querySelector('.graphic')
        var triggerEls = selectionToArray(graphicEl.querySelectorAll('.trigger'))
        var preProse = document.querySelector('.preProse')
        var postProse = document.querySelector('.postProse')
        var legendInst = document.querySelector('.legendInstructions')

        // a global function creates and handles all the vis + updates
        var graphic = createGraphic('.graphic')

        // setup a waypoint trigger for each trigger element
        var waypoints = triggerEls.map(function(el) {

          // get the step, cast as number
          var step = +el.getAttribute('data-step')

          return new Waypoint({
            element: el, // our trigger element
            handler: function(direction) {
              // if the direction is down then we use that number,
              // else, we want to trigger the previous one
              var nextStep = direction === 'down' ? step : Math.max(0, step - 1)

              // tell our graphic to update with a specific step
              graphic.update(nextStep)

              // the "active" class is shown with opacity 1, the others are shown with reduced opacity
              // managing the "active" states is made much more complicated by the fact
              //   that there are three text sections that are NOT tied to waypoints
              if (direction === 'down') {
                triggerEls[Math.max(0, step - 1)].classList.remove("active")
                triggerEls[step].classList.add("active")
                if (step === 1) {
                  preProse.classList.remove("active")
                  legendInst.classList.add("active")
                } else if (step === 2) {legendInst.classList.remove("active")}
                else if (step === 11) {postProse.classList.add("active")}
              } else {
                triggerEls[step].classList.remove("active")
                triggerEls[nextStep].classList.add("active")
                if (nextStep === 0) {
                  preProse.classList.add("active")
                  legendInst.classList.remove("active")
                } else if (nextStep === 1) {legendInst.classList.add("active")}
                else if (nextStep === 10) {postProse.classList.remove("active")}
              }

            },
            offset: '68%',  // trigger 65% down from top of the viewport
          }) // return new Waypoint
        }) // var waypoints

      } // waypoints()

      waypoints()

    })()
  </script>

  <!-- run javascript to include external html files where specified -->
  <script>includeHTML()</script>

</body>

</html>
